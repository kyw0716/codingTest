SELECT a.CAR_ID, a.CAR_TYPE, ROUND(a.DAILY_FEE*(1-c.DISCOUNT_RATE/100)*30) AS FEE
FROM CAR_RENTAL_COMPANY_CAR a
INNER JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY b ON (a.CAR_ID = b.CAR_ID)
INNER JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN c ON (a.CAR_TYPE = c.CAR_TYPE)
WHERE a.CAR_TYPE in ('세단', 'SUV') AND c.DURATION_TYPE = '30일 이상'
AND (DATEDIFF('2022-11-31', b.START_DATE) <= 30
OR DATEDIFF('2022-11-31', b.END_DATE) <= 30) 
-- AND (b.START_DATE BETWEEN '2022-11-01' AND '2022-11-31'
-- OR b.END_DATE between '2022-11-01' and '2022-11-31')
-- AND (DATEDIFF('2022-11-01', b.END_DATE) > 0 
-- OR DATEDIFF(b.START_DATE, '2022-11-31') > 0)
AND ROUND(a.DAILY_FEE*(1-c.DISCOUNT_RATE/100)*30) >= 500000
AND ROUND(a.DAILY_FEE*(1-c.DISCOUNT_RATE/100)*30) < 2000000
GROUP BY a.CAR_ID
ORDER BY FEE DESC, a.CAR_TYPE ASC, a.CAR_ID DESC

    
--나는 날짜부분이 이해가지 않는다 애초에 11월 통째로 쓸 수 있는 차면 그 전 or 이후에 빌려야하는거 아님?